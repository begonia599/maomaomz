const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["index.js","index.css"])))=>i.map(i=>d[i]);
import{_ as e}from'./index.js';function n(){const e=window;if(e.SillyTavern&&'function'==typeof e.SillyTavern.generateQuietPrompt)return e.SillyTavern;try{const e=window.parent;if(e?.SillyTavern&&'function'==typeof e.SillyTavern.generateQuietPrompt)return e.SillyTavern}catch(n){}if(void 0!==globalThis.SillyTavern){const e=globalThis.SillyTavern;if('function'==typeof e.generateQuietPrompt)return e}return null}async function t(t,r,i){const{filterApiParams:o}=await e(async()=>{const{filterApiParams:e}=await import('./index.js').then(e=>e.s);return{filterApiParams:e}},__vite__mapDeps([0,1])),{normalizeApiEndpoint:a}=await e(async()=>{const{normalizeApiEndpoint:e}=await import('./index.js').then(e=>e.s);return{normalizeApiEndpoint:e}},__vite__mapDeps([0,1]));if(r.use_tavern_api){console.log('ğŸº ä½¿ç”¨é…’é¦† API å‘é€è¯·æ±‚ï¼ˆç»•è¿‡ CORSï¼‰...');const e=n();if(!e)throw console.error('âŒ SillyTavern API ä¸å¯ç”¨ï¼Œå°è¯•çš„ä½ç½®:',{window:!!window.SillyTavern,parent:!!window.parent?.SillyTavern,globalThis:!!globalThis.SillyTavern}),new Error('é…’é¦† API ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿åœ¨ SillyTavern ç¯å¢ƒä¸­è¿è¡Œï¼Œæˆ–å…³é—­"ä½¿ç”¨é…’é¦† API"é€‰é¡¹');const o=t.map(e=>e.content).join('\n\n'),a=e.generateQuietPrompt(),l=await a(o,!1,!0,void 0,void 0,r.max_tokens);if(!l||''===l.trim())throw new Error('é…’é¦† API è¿”å›äº†ç©ºç»“æœ');return i?.onProgress?.(100),console.log('âœ… é€šè¿‡é…’é¦† API æˆåŠŸè·å–å“åº”'),l.trim()}const l=a(r.api_endpoint),s=o({model:r.model||'gpt-3.5-turbo',max_tokens:r.max_tokens||4e3,temperature:i?.temperature??r.temperature??.7,top_p:r.top_p,presence_penalty:r.presence_penalty,frequency_penalty:r.frequency_penalty,messages:t},r.api_endpoint),p=await fetch(l,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${r.api_key}`},body:JSON.stringify(s)});if(!p.ok){const e=await p.text();throw new Error(`API è¯·æ±‚å¤±è´¥ (${p.status}): ${e}`)}const c=await p.json();return i?.onProgress?.(100),c.choices?.[0]?.message?.content?.trim()||''}export{t as callAIWithTavernSupport,n as getSillyTavernAPI};
//# sourceMappingURL=api.IUD4ImMW.chunk.js.map
