const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["index.js","index.css"])))=>i.map(i=>d[i]);
import{_ as e}from'./index.js';function t(){const e=window;try{const t=e.SillyTavern||e.parent?.SillyTavern;if(t&&'function'==typeof t.getContext){const e=t.getContext();if(e&&'function'==typeof e.generateQuietPrompt)return console.log('âœ… ä» SillyTavern.getContext() è·å–åˆ° generateQuietPrompt'),e.generateQuietPrompt.bind(e)}}catch(t){console.log('âš ï¸ ä» getContext è·å–å¤±è´¥:',t)}try{const t=e.SillyTavern||e.parent?.SillyTavern;if(t&&'function'==typeof t.generateQuietPrompt)return console.log('âœ… ç›´æ¥ä» SillyTavern å¯¹è±¡è·å–åˆ° generateQuietPrompt'),t.generateQuietPrompt.bind(t)}catch(t){console.log('âš ï¸ ç›´æ¥è·å–å¤±è´¥:',t)}if('function'==typeof e.generateQuietPrompt)return console.log('âœ… ä»å…¨å±€å‡½æ•°è·å–åˆ° generateQuietPrompt'),e.generateQuietPrompt;try{if('function'==typeof e.parent?.generateQuietPrompt)return console.log('âœ… ä» parent window è·å–åˆ° generateQuietPrompt'),e.parent.generateQuietPrompt}catch(t){}return console.log('âŒ æ— æ³•æ‰¾åˆ° generateQuietPrompt å‡½æ•°'),console.log('ğŸ” è°ƒè¯•ä¿¡æ¯:',{'window.SillyTavern':!!e.SillyTavern,'window.SillyTavern.getContext':typeof e.SillyTavern?.getContext,'window.generateQuietPrompt':typeof e.generateQuietPrompt,'parent.SillyTavern':!!e.parent?.SillyTavern}),null}async function n(n,o,r){const{filterApiParams:i}=await e(async()=>{const{filterApiParams:e}=await import('./index.js').then(e=>e.s);return{filterApiParams:e}},__vite__mapDeps([0,1])),{normalizeApiEndpoint:a}=await e(async()=>{const{normalizeApiEndpoint:e}=await import('./index.js').then(e=>e.s);return{normalizeApiEndpoint:e}},__vite__mapDeps([0,1]));if(o.use_tavern_api){console.log('ğŸº ä½¿ç”¨é…’é¦† API å‘é€è¯·æ±‚ï¼ˆç»•è¿‡ CORSï¼‰...');const e=t();if(!e)throw new Error('é…’é¦† API ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿åœ¨ SillyTavern ç¯å¢ƒä¸­è¿è¡Œï¼Œæˆ–å…³é—­"ä½¿ç”¨é…’é¦† API"é€‰é¡¹');const i=n.map(e=>e.content).join('\n\n'),a=await e(i,!1,!0,void 0,void 0,o.max_tokens);if(!a||''===a.trim())throw new Error('é…’é¦† API è¿”å›äº†ç©ºç»“æœ');return r?.onProgress?.(100),console.log('âœ… é€šè¿‡é…’é¦† API æˆåŠŸè·å–å“åº”'),a.trim()}const p=a(o.api_endpoint),l=i({model:o.model||'gpt-3.5-turbo',max_tokens:o.max_tokens||4e3,temperature:r?.temperature??o.temperature??.7,top_p:o.top_p,presence_penalty:o.presence_penalty,frequency_penalty:o.frequency_penalty,messages:n},o.api_endpoint),s=await fetch(p,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${o.api_key}`},body:JSON.stringify(l)});if(!s.ok){const e=await s.text();throw new Error(`API è¯·æ±‚å¤±è´¥ (${s.status}): ${e}`)}const c=await s.json();return r?.onProgress?.(100),c.choices?.[0]?.message?.content?.trim()||''}export{n as callAIWithTavernSupport,t as getGenerateQuietPrompt};
//# sourceMappingURL=api.BS-qRbD0.chunk.js.map
